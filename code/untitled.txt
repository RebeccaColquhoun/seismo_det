        def calc_distance(tr):
            """


            Parameters
            ----------
            tr : obspy trace
                trace object.

            Returns
            -------
            distance : float
                distance from station to earthquake in km.

            """
            inv = eq.inv
            station = tr.stats.station
            station = station.ljust(4)
            sta_lat = inv.select(network=tr.stats.network, station=tr.stats.station)[0][0].latitude
            sta_long = inv.select(network=tr.stats.network, station=tr.stats.station)[0][0].longitude
            distance = geopy.distance.distance((eq.event_stats['eq_lat'],eq.event_stats['eq_long']),(sta_lat,sta_long))
            return distance

        if eq.data is not False:
            list_iv2 = []
            list_iv2_distance = []
            list_iv2_stations = []
            data_interp = eq.data.copy()
            data_interp.interpolate(100, 'lanczos', a=20)
            picks = eq.data_stats['picks']

            for i in range(0, len(data_interp)):  # iterate through all traces
                tr_name = data_interp[i].stats.network+'.'+data_interp[i].stats.station+'.'+data_interp[i].stats.location
                if data_interp[i].stats.channel[2] == 'Z' and tr_name in picks.keys():  # only use vertical components at stations with a pick
                    trace = data_interp[i].copy()
                    tr_name = trace.stats.network+'.'+trace.stats.station+'.'+trace.stats.location
                    #try:
                    pick = UTCDateTime(picks[tr_name])
                    pick_samples = int(round((UTCDateTime(pick) - trace.stats.starttime)*trace.stats.sampling_rate, 0))
                    sampling_rate = trace.stats.sampling_rate
                    if distance < 200:
                        iv2 = actual_iv2_calculation(trace, pick, 0.3, subtract_bkg)
                        dist = calc_distance(trace)
                        list_iv2.append(iv2)
                        list_iv2_distance.append(dist)
                        list_iv2_stations.append(tr_name)
                    #except Exception:
                    #    continue